<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - GPUHUB</title>
    <link rel="icon" type="image/png" th:href="@{/img/g.PNG}">
    <link rel="stylesheet" th:href="@{/css/registro.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <th:block th:replace="fragments/header :: head"></th:block>
</head>
<body class="fondo-login">
  <!-- Contenedor para el efecto de part√≠culas -->
  <div id="particles-js"></div>
  <div th:replace="fragments/header :: header"></div>

  <div class="contenedor-principal">
    <div class="contenedor-login">
      <div class="tarjeta-login" style="max-width: 600px;">
        <div class="encabezado-login">
          <h1>Crear Cuenta</h1>
          <p>√önete a GPUHUB</p>
        </div>
        
        <form class="formulario-login" th:action="@{/registro}" method="post" th:object="${usuario}" enctype="multipart/form-data">
          <div class="mensaje-error" th:if="${error}" th:text="${error}"></div>
          
          <div class="formulario-filas">
            <div class="grupo-formulario">
              <label for="dni">DNI</label>
              <input type="text" id="dni" name="dni" required 
                     th:class="${#fields.hasErrors('dni')} ? 'is-invalid' : ''"
                     placeholder="Ingresa tu DNI" pattern="\d{8}" 
                     maxlength="8" minlength="8"
                     oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                     title="El DNI debe tener 8 d√≠gitos"
                     th:value="${usuario.dni}">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('dni')}" th:errors="*{dni}"></div>
              <div class="invalid-feedback" th:unless="${#fields.hasErrors('dni')}">Por favor ingresa un DNI v√°lido de 8 d√≠gitos</div>
            </div>
            
            <div class="grupo-formulario">
              <label for="telefono">Tel√©fono</label>
              <input type="tel" id="telefono" name="telefono" required 
                     th:class="${#fields.hasErrors('telefono')} ? 'is-invalid' : ''"
                     placeholder="Ingresa tu tel√©fono" pattern="\d{9}"
                     maxlength="9" minlength="9"
                     oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                     title="El tel√©fono debe tener 9 d√≠gitos"
                     th:value="${usuario.telefono}">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}"></div>
              <div class="invalid-feedback" th:unless="${#fields.hasErrors('telefono')}">Por favor ingresa un n√∫mero de tel√©fono v√°lido de 9 d√≠gitos</div>
            </div>
          </div>
          
          <div class="formulario-filas">
            <div class="grupo-formulario">
              <label for="nombres">Nombres</label>
              <input type="text" id="nombres" name="nombres" required 
                     th:class="${#fields.hasErrors('nombres')} ? 'is-invalid' : ''"
                     placeholder="Ingresa tus nombres"
                     th:value="${usuario.nombres}">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('nombres')}" th:errors="*{nombres}"></div>
            </div>
            
            <div class="grupo-formulario">
              <label for="apellidos">Apellidos</label>
              <input type="text" id="apellidos" name="apellidos" required 
                     th:class="${#fields.hasErrors('apellidos')} ? 'is-invalid' : ''"
                     placeholder="Ingresa tus apellidos"
                     th:value="${usuario.apellidos}">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('apellidos')}" th:errors="*{apellidos}"></div>
            </div>
          </div>
          
          <div class="grupo-formulario">
            <label for="correo">Correo Electr√≥nico</label>
            <input type="email" id="correo" name="correo" required 
                   th:class="${#fields.hasErrors('correo')} ? 'is-invalid' : ''"
                   placeholder="tucorreo@ejemplo.com"
                   th:value="${usuario.correo}">
            <div class="invalid-feedback" th:if="${#fields.hasErrors('correo')}" th:errors="*{correo}"></div>
          </div>
          
          <div class="grupo-formulario">
            <label for="direccion">Direcci√≥n</label>
            <input type="text" id="direccion" name="direccion" required 
                   th:class="${#fields.hasErrors('direccion')} ? 'is-invalid' : ''"
                   placeholder="Ingresa tu direcci√≥n"
                   th:value="${usuario.direccion}">
            <div class="invalid-feedback" th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}"></div>
          </div>
          
          <div class="grupo-formulario">
            <label for="ruc">RUC</label>
            <input type="text" id="ruc" name="ruc" required
                   th:class="${#fields.hasErrors('ruc')} ? 'is-invalid' : ''"
                   placeholder="Ingresa el RUC de la tienda"
                   pattern="\d{11}" maxlength="11" minlength="11"
                   oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                   title="El RUC debe tener 11 d√≠gitos"
                   th:value="${usuario.ruc}">
            <div class="invalid-feedback" th:if="${#fields.hasErrors('ruc')}" th:errors="*{ruc}"></div>
            <div class="invalid-feedback" th:unless="${#fields.hasErrors('ruc')}">El RUC debe tener exactamente 11 d√≠gitos</div>
          </div>
          
          <div class="grupo-formulario">
            <label for="nombreTienda">Nombre de la Tienda</label>
            <input type="text" id="nombreTienda" name="nombreTienda" required 
                   th:class="${#fields.hasErrors('nombreTienda')} ? 'is-invalid' : ''"
                   placeholder="Ingresa el nombre de la tienda a registrar"
                   th:value="${usuario.nombreTienda}">
            <div class="invalid-feedback" th:if="${#fields.hasErrors('nombreTienda')}" th:errors="*{nombreTienda}"></div>
          </div>
          
          <div class="grupo-formulario">
            <label for="imagenTienda">Imagen de la Tienda</label>
            <input type="file" id="imagenTienda" name="imagenTienda" accept="image/*" required class="form-control">
            <div class="invalid-feedback">Por favor selecciona una imagen para la tienda.</div>
          </div>
          
          <div class="grupo-formulario">
            <label style="font-weight: bold; margin-bottom: 10px; display: block;">Preguntas de seguridad (para recuperaci√≥n de contrase√±a)</label>
          </div>
          <div class="grupo-formulario">
            <label for="primoFavorito" class="form-label">¬øNombre de tu primo favorito?</label>
            <input type="text" id="primoFavorito" name="primoFavorito" class="form-control" required placeholder="Escribe el nombre de tu primo favorito" th:value="${usuario.primoFavorito}">
          </div>
          <div class="grupo-formulario">
            <label for="animalFavorito" class="form-label">¬øTu animal favorito?</label>
            <input type="text" id="animalFavorito" name="animalFavorito" class="form-control" required placeholder="Escribe tu animal favorito" th:value="${usuario.animalFavorito}">
          </div>
          <div class="grupo-formulario">
            <label for="lugarFavorito" class="form-label">¬øTu lugar favorito?</label>
            <input type="text" id="lugarFavorito" name="lugarFavorito" class="form-control" required placeholder="Escribe tu lugar favorito" th:value="${usuario.lugarFavorito}">
          </div>
          
          <div class="grupo-formulario">
            <label for="contrasena">Contrase√±a</label>
            <div class="contenedor-contrasena">
              <input type="password" id="contrasena" name="contrasena" required
                     th:class="${#fields.hasErrors('contrasena')} ? 'is-invalid' : ''"
                     placeholder="Crea una contrase√±a"
                     th:value="${usuario.contrasena}">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('contrasena')}" th:errors="*{contrasena}"></div>
              <button type="button" class="boton-mostrar" 
                      onclick="mostrarContrasena('contrasena')">
                üëÅÔ∏è
              </button>
            </div>
          </div>
          
          <div class="grupo-formulario">
            <label for="confirmarContrasena">Confirmar Contrase√±a</label>
            <div class="contenedor-contrasena">
              <input type="password" id="confirmarContrasena" name="confirmarContrasena" required
                     th:class="${#fields.hasErrors('confirmarContrasena')} ? 'is-invalid' : ''"
                     placeholder="Confirma tu contrase√±a"
                     th:value="${usuario.confirmarContrasena}">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('confirmarContrasena')}" th:errors="*{confirmarContrasena}"></div>
              <button type="button" class="boton-mostrar" 
                      onclick="mostrarContrasena('confirmarContrasena')">
                üëÅÔ∏è
              </button>
            </div>
          </div>
          
          <div class="opciones-login">
            <label class="recordar">
              <input type="checkbox" name="terminos" required>
              Acepto los <a th:href="@{/condiciones}" class="enlace-olvido">t√©rminos y condiciones</a>
            </label>
          </div>
          
          <button type="submit" class="boton-primario">Registrarse</button>
        </form>
        
        <div class="registro">
          <p>¬øYa tienes una cuenta? <a th:href="@{/login}">Inicia sesi√≥n</a></p>
        </div>
      </div>
    </div>
  </div>

  <script th:src="@{/js/particulas.js}"></script>
  <script>
    // Funci√≥n para mostrar/ocultar contrase√±a
    function mostrarContrasena(id) {
      const input = document.getElementById(id);
      if (input.type === 'password') {
        input.type = 'text';
      } else {
        input.type = 'password';
      }
    }

    // Validaci√≥n de formulario
    (function() {
      'use strict';
      window.addEventListener('load', function() {
        // Obtener el formulario
        var form = document.querySelector('.formulario-login');
        
        // Validar al enviar el formulario
        form.addEventListener('submit', function(event) {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          
          // Validar que las contrase√±as coincidan
          const contrasena = document.getElementById('contrasena');
          const confirmarContrasena = document.getElementById('confirmarContrasena');
          
          if (contrasena.value !== confirmarContrasena.value) {
            event.preventDefault();
            event.stopPropagation();
            confirmarContrasena.setCustomValidity('Las contrase√±as no coinciden');
            confirmarContrasena.reportValidity();
          } else {
            confirmarContrasena.setCustomValidity('');
          }
          
          form.classList.add('was-validated');
        }, false);
      }, false);
    })();
  </script>

  <div th:replace="fragments/footer :: footer"></div>
  <div th:replace="fragments/footer :: scripts"></div>
</body>
</html>
